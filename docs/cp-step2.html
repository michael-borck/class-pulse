<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ClassPulse Step 2: Core Flask Application Files</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Tailwind CSS via jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts: Inter -->
    <link href="https://cdn.jsdelivr.net/npm/@fontsource/inter@3.3.1/index.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', Arial, sans-serif; background: #f9fafb;}
        code, pre { font-family: 'Fira Mono', 'Consolas', 'Monaco', monospace !important; }
        pre {
            background: #1e293b;
            color: #d1d5db;
            border-radius: 0.5rem;
            padding: 1em;
            margin-bottom: 1.5em;
            font-size: 0.98em;
            overflow-x: auto;
            line-height: 1.6;
        }
        h1, h2, h3, h4 { color: #0f172a; }
        .file-header {
            background: #e0e7ef;
            color: #334155;
            font-size: 1.1em;
            padding: 0.25em 1em;
            border-left: 5px solid #6d28d9;
            margin-bottom: 0.5em;
            margin-top: 1.5em;
        }
        .fa-file-code { color: #6d28d9; }
        section { margin-bottom: 2.25em; }
        @media print {
            pre { background: #fafafa !important; color: #212121 !important; }
        }
    </style>
</head>
<body class="min-h-screen">

    <main class="max-w-4xl mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-4xl font-black flex gap-3 items-center"><i class="fa-solid fa-code"></i> ClassPulse: Step 2
            </h1>
            <h2 class="text-2xl font-semibold mt-2">Creating the core Flask application files (<code>app.py</code>, <code>config.py</code>, and <code>models.py</code>)</h2>
            <p class="mt-3 text-lg">This step provides skeleton files for your Flask backend, using a modular structure and SQLite for persistence. Code sections are fully copy-paste ready and annotated for clarity. The design is optimized for PDF export with all content visible, no scroll bars or page breaks.</p>
        </header>

        <section id="project-overview">
            <h3 class="text-xl font-bold mt-8 mb-2 flex items-center gap-2"><i class="fa-regular fa-folder"></i> Project Skeleton</h3>
            <pre>
classpulse/
├── app.py
├── config.py
├── models.py
├── ... (other folders from previous step)
            </pre>
            <p class="mb-2 text-gray-700">The following are the core Python files for the backend:</p>
            <ul class="list-disc ml-6 text-gray-800">
                <li><strong>app.py</strong> &mdash; Main Flask entry point and Socket.IO support</li>
                <li><strong>config.py</strong> &mdash; Centralized configuration (e.g., secret keys, DB URI)</li>
                <li><strong>models.py</strong> &mdash; Data models (using SQLite via SQLAlchemy)</li>
            </ul>
        </section>

        <section id="config-py">
            <div class="file-header flex items-center gap-2"><i class="fa-solid fa-gear"></i> config.py</div>
            <p class="mb-2">This file sets up basic configuration, including a secure secret key and SQLite DB URI.</p>
            <pre>
# config.py

import os

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-secret-classpulse'
    SQLALCHEMY_DATABASE_URI = 'sqlite:///instance/classpulse.db'
    SQLALCHEMY_TRACK_MODIFICATIONS = False
</pre>
        </section>

        <section id="models-py">
            <div class="file-header flex items-center gap-2"><i class="fa-solid fa-database"></i> models.py</div>
            <p class="mb-2">Defines your primary data models. For simplicity, all tables are kept in this initial file. Expand as needed.</p>
            <pre>
# models.py

from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Session(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    code = db.Column(db.String(8), unique=True, nullable=False)
    presenter_id = db.Column(db.String(128), nullable=False)
    is_active = db.Column(db.Boolean, default=True)

class Question(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    session_id = db.Column(db.Integer, db.ForeignKey('session.id'), nullable=False)
    qtype = db.Column(db.String(32), nullable=False)  # 'mc', 'wordcloud', 'rating'
    content = db.Column(db.String(512), nullable=False)
    options = db.Column(db.String(1024))  # JSON-encoded options (for multiple choice, scale)
    is_open = db.Column(db.Boolean, default=True)

class Answer(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    question_id = db.Column(db.Integer, db.ForeignKey('question.id'), nullable=False)
    value = db.Column(db.String(512), nullable=False)
    audience_id = db.Column(db.String(128), nullable=True)  # could be anonymous
    submitted_at = db.Column(db.DateTime, server_default=db.func.now())
</pre>
            <p class="text-gray-700 mb-2">You can adjust and expand these models as the application evolves (e.g., add usernames for presenters, session settings, etc.).</p>
        </section>

        <section id="app-py">
            <div class="file-header flex items-center gap-2"><i class="fa-brands fa-python"></i> app.py</div>
            <p class="mb-2">This file initializes Flask, SQLAlchemy, and Flask-SocketIO, and registers simple test routes. All routes, blueprints, and Socket.IO events can be extended from here.</p>
            <pre>
# app.py

from flask import Flask, render_template, request, redirect, url_for
from flask_socketio import SocketIO
from config import Config
from models import db

def create_app():
    app = Flask(__name__)
    app.config.from_object(Config)
    db.init_app(app)
    socketio = SocketIO(app)

    # Example route
    @app.route('/')
    def index():
        return "Welcome to ClassPulse! Backend is up."

    # Initialize DB
    @app.before_first_request
    def create_tables():
        db.create_all()

    # Example Socket.IO handler
    @socketio.on('ping')
    def handle_ping(data):
        print('Ping received:', data)
        return {'response': 'pong'}

    return app, socketio

if __name__ == '__main__':
    app, socketio = create_app()
    socketio.run(app, host='0.0.0.0', port=5000, debug=True)
</pre>
            <ul class="list-disc ml-8 text-gray-700 mb-2">
                <li>Instantiates the Flask app with config</li>
                <li>Initializes the database and Socket.IO</li>
                <li>Defines a simple root route and a minimal Socket.IO handler (for testing connectivity)</li>
            </ul>
        </section>

        <section id="next-steps" class="mt-12">
            <h4 class="text-lg font-semibold mb-2 flex items-center gap-2"><i class="fa-solid fa-compass"></i> Next Steps</h4>
            <ol class="list-decimal ml-8 text-gray-800 mb-2">
                <li>Set up the folder structure and place these files as shown above.</li>
                <li>Install dependencies: <code>pip install flask flask_sqlalchemy flask_socketio</code></li>
                <li>Test app launch: <code>python app.py</code> – ensure no errors and basic routes work.</li>
                <li>Continue to implement templates, static frontend files, and detailed app routes.</li>
            </ol>
            <p class="text-sm text-gray-500 mt-3">
                <i class="fa-solid fa-circle-info"></i> This step is optimized for direct conversion to PDF with all code and notes on one page.
            </p>
        </section>
    
    </main>
</body>
</html>

